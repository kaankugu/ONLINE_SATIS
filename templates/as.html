{% load static %}
<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>GiriÅŸ Yap</title>
  <link rel="stylesheet" href="{% static 'css/login.css' %}">
  <script src="{% static 'js/api.js' %}"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
  <div class="login-container">
    <form method="POST" class="login-form">
      {% csrf_token %}
      <h2>GiriÅŸ Yap</h2>

      <input type="text" name="username" placeholder="KullanÄ±cÄ± AdÄ±" required>
      <input type="password" name="password" placeholder="Åifre" required>

      <button type="submit">GiriÅŸ Yap</button>

      <p class="register-link">HesabÄ±n yok mu? <a href="/register/">KayÄ±t Ol</a></p>
    </form>

    <div class="google-login">
      <div id="g_id_onload"
           data-client_id="359671172063-gqf8hp822gmhm1bhht01v8s0dp6m9itl.apps.googleusercontent.com"
           data-callback="handleGoogleCredential"
           data-auto_prompt="false">
      </div>

      <div class="g_id_signin"
           data-type="standard"
           data-size="large"
           data-theme="outline"
           data-text="sign_in_with"
           data-shape="rectangular"
           data-logo_alignment="left">
      </div>
    </div>
  </div>

  <script>
    async function handleGoogleCredential(response) {
      console.log("ğŸ¯ Google'dan response:", response);

      const accessToken = response.credential;
      console.log("âœ… Access Token:", accessToken);

      try {
        const res = await fetch('/api/google/login/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ access_token: accessToken })
        });

        const data = await res.json();
        console.log("ğŸ“¥ Backend response:", data);

        if (res.ok) {
          alert('Google ile giriÅŸ baÅŸarÄ±lÄ±!');
          window.location.href = '/';
        } else {
          alert('âŒ GiriÅŸ baÅŸarÄ±sÄ±z!');
        }
      } catch (err) {
        console.error("ğŸš¨ Sunucu hatasÄ±:", err);
      }
    }
  </script>
</body>
</html>